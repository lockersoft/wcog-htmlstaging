name: Deploy to production

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Set up SSH key
        run: |
          env
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -p 22 whatcomhtml.lockersoft.dev >> ~/.ssh/known_hosts

      - uses: actions/checkout@v2
      - uses: contention/rsync-deployments@v2.0.0
        with:
          FLAGS: -avzr --delete
          EXCLUDES: --exclude .htaccess --exclude /uploads/
          USER: dh_qp73ft
          HOST: whatcomhtml.lockersoft.dev
          LOCALPATH: /dist/
          REMOTEPATH: ~/dh_qp73ft/whatcomhtml.lockersoft.dev/
          DEPLOY_KEY: ${{ secrets.SSH_PRIVATE_KEY }}


#name: remote ssh command
##on: [push]
#jobs:

#  build:
#    name: Build
 #   runs-on: ubuntu-latest
  #  steps:
   # - name: executing remote ssh commands using password
    #  uses: appleboy/ssh-action@v1.0.3
     # with:
      #  host: whatcomhtml.lockersoft.dev
       # username: dh_qp73ft
        #password: ${{ secrets.SSH_KEY }}
    #    port: 22
     #   script: whoami
